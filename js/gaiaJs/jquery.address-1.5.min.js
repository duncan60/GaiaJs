/*
 * jQuery Address Plugin v1.5
 * http://www.asual.com/jquery/address/
 *
 * Copyright (c) 2009-2010 Rostislav Hristov
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * Date: 2012-02-25 21:21:40 +0200 (Sat, 25 Feb 2012)
 */
(function(c){c.address=function(){var q=function(a){c(c.address).trigger(c.extend(c.Event(a),function(){for(var b={},e=c.address.parameterNames(),k=0,p=e.length;k<p;k++)b[e[k]]=c.address.parameter(e[k]);return{value:c.address.value(),path:c.address.path(),pathNames:c.address.pathNames(),parameterNames:e,parameters:b,queryString:c.address.queryString()}}.call(c.address)))},s=function(a){return Array.prototype.slice.call(a)},g=function(){c().bind.apply(c(c.address),Array.prototype.slice.call(arguments));
return c.address},G=function(){return z.pushState&&d.state!==i},T=function(){return("/"+n.pathname.replace(new RegExp(d.state),"")+n.search+(H()?"#"+H():"")).replace(S,"/")},H=function(){var a=n.href.indexOf("#");return a!=-1?w(n.href.substr(a+1),l):""},t=function(){return G()?T():H()},U=function(){return"javascript"},M=function(a){a=a.toString();return(d.strict&&a.substr(0,1)!="/"?"/":"")+a},w=function(a,b){if(d.crawlable&&b)return(a!==""?"!":"")+a;return a.replace(/^\!/,"")},u=function(a,b){return parseInt(a.css(b),
10)},D=function(){if(!I){var a=t();if(f!=a)if(A&&B<7)n.reload();else{A&&!J&&d.history&&r(N,50);f=a;C(l)}}},C=function(a){q(V);q(a?W:X);r(da,10)},da=function(){if(d.tracker!=="null"&&d.tracker!==null){var a=c.isFunction(d.tracker)?d.tracker:h[d.tracker],b=(n.pathname+n.search+(c.address&&!G()?c.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(c.isFunction(a))a(b);else if(c.isFunction(h.urchinTracker))h.urchinTracker(b);else if(h.pageTracker!==i&&c.isFunction(h.pageTracker._trackPageview))h.pageTracker._trackPageview(b);
else h._gaq!==i&&c.isFunction(h._gaq.push)&&h._gaq.push(["_trackPageview",decodeURI(b)])}},N=function(){var a=U()+":"+l+";document.open();document.writeln('<html><head><title>"+m.title.replace(/\'/g,"\\'")+"</title><script>var "+x+' = "'+t()+(m.domain!=n.hostname?'";document.domain="'+m.domain:"")+"\";<\/script></head></html>');document.close();";if(B<7)j.src=a;else j.contentWindow.location.replace(a)},Z=function(){if(E&&Y!=-1){var a,b,e=E.substr(Y+1).split("&");for(a=0;a<e.length;a++){b=e[a].split("=");
if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(b[0]))d[b[0]]=isNaN(b[1])?/^(true|yes)$/i.test(b[1]):parseInt(b[1],10)!==0;if(/^(state|tracker)$/.test(b[0]))d[b[0]]=b[1]}E=null}f=t()},aa=function(){if(!$){$=o;Z();var a=function(){ea.call(this);fa.call(this)},b=c("body").ajaxComplete(a);a();if(d.wrap){c("body > *").wrapAll('<div style="padding:'+(u(b,"marginTop")+u(b,"paddingTop"))+"px "+(u(b,"marginRight")+u(b,"paddingRight"))+"px "+(u(b,"marginBottom")+u(b,"paddingBottom"))+"px "+(u(b,"marginLeft")+
u(b,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+x+'" style="height:100%;overflow:auto;position:relative;'+(K&&!window.statusbar.visible?"resize:both;":"")+'" />');c("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});K&&c('<style type="text/css" />').appendTo("head").text("#"+x+"::-webkit-resizer { background-color: #fff; }")}if(A&&!J){a=m.getElementsByTagName("frameset")[0];j=m.createElement((a?"":"i")+"frame");j.src=U()+":"+l;if(a){a.insertAdjacentElement("beforeEnd",
j);a[a.cols?"cols":"rows"]+=",0";j.noResize=o;j.frameBorder=j.frameSpacing=0}else{j.style.display="none";j.style.width=j.style.height=0;j.tabIndex=-1;m.body.insertAdjacentElement("afterBegin",j)}r(function(){c(j).bind("load",function(){var e=j.contentWindow;f=e[x]!==i?e[x]:"";if(f!=t()){C(l);n.hash=w(f,o)}});j.contentWindow[x]===i&&N()},50)}r(function(){q("init");C(l)},1);if(!G())if(J)if(h.addEventListener)h.addEventListener(F,D,l);else h.attachEvent&&h.attachEvent("on"+F,D);else ga(D,50);"state"in
window.history&&c(window).trigger("popstate")}},ea=function(){var a,b=c("a"),e=b.size(),k=-1,p=function(){if(++k!=e){a=c(b.get(k));a.is('[rel*="address:"]')&&a.address('[rel*="address:"]');r(p,1)}};r(p,1)},fa=function(){if(d.crawlable){var a=n.pathname.replace(/\/$/,"");c("body").html().indexOf("_escaped_fragment_")!=-1&&c('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var b=c(this).attr("href").replace(/^http:/,"").replace(new RegExp(a+"/?$"),"");if(b===""||b.indexOf("_escaped_fragment_")!=
-1)c(this).attr("href","#"+encodeURI(decodeURIComponent(b.replace(/\/(.*)\?_escaped_fragment_=(.*)$/)),"!$2"))})}},i,x="jQueryAddress",F="hashchange",V="change",W="internalChange",X="externalChange",o=true,l=false,d={autoUpdate:o,crawlable:l,history:o,strict:o,wrap:l},y=c.browser,B=parseFloat(y.version),A=!c.support.opacity,K=y.webkit||y.safari,h=function(){try{return top.document!==i?top:window}catch(a){return window}}(),m=h.document,z=h.history,n=h.location,ga=setInterval,r=setTimeout,S=/\/{2,9}/g;
y=navigator.userAgent;var J="on"+F in h,j,E=c("script:last").attr("src"),Y=E?E.indexOf("?"):-1,O=m.title,I=l,$=l,ba=o,L=l,f=t();if(A){B=parseFloat(y.substr(y.indexOf("MSIE")+4));if(m.documentMode&&m.documentMode!=B)B=m.documentMode!=8?7:8;var ca=m.onpropertychange;m.onpropertychange=function(){ca&&ca.call(m);if(m.title!=O&&m.title.indexOf("#"+t())!=-1)m.title=O}}if(z.navigationMode)z.navigationMode="compatible";if(document.readyState=="complete")var ha=setInterval(function(){if(c.address){aa();clearInterval(ha)}},
50);else{Z();c(aa)}c(window).bind("popstate",function(){if(f!=t()){f=t();C(l)}}).bind("unload",function(){if(h.removeEventListener)h.removeEventListener(F,D,l);else h.detachEvent&&h.detachEvent("on"+F,D)});return{bind:function(){return g.apply(this,s(arguments))},init:function(){return g.apply(this,["init"].concat(s(arguments)))},change:function(){return g.apply(this,[V].concat(s(arguments)))},internalChange:function(){return g.apply(this,[W].concat(s(arguments)))},externalChange:function(){return g.apply(this,
[X].concat(s(arguments)))},baseURL:function(){var a=n.href;if(a.indexOf("#")!=-1)a=a.substr(0,a.indexOf("#"));if(/\/$/.test(a))a=a.substr(0,a.length-1);return a},autoUpdate:function(a){if(a!==i){d.autoUpdate=a;return this}return d.autoUpdate},crawlable:function(a){if(a!==i){d.crawlable=a;return this}return d.crawlable},history:function(a){if(a!==i){d.history=a;return this}return d.history},state:function(a){if(a!==i){d.state=a;var b=T();if(d.state!==i)if(z.pushState)b.substr(0,3)=="/#/"&&n.replace(d.state.replace(/^\/$/,
"")+b.substr(2));else b!="/"&&b.replace(/^\/#/,"")!=H()&&r(function(){n.replace(d.state.replace(/^\/$/,"")+"/#"+b)},1);return this}return d.state},strict:function(a){if(a!==i){d.strict=a;return this}return d.strict},tracker:function(a){if(a!==i){d.tracker=a;return this}return d.tracker},wrap:function(a){if(a!==i){d.wrap=a;return this}return d.wrap},update:function(){L=o;this.value(f);L=l;return this},title:function(a){if(a!==i){r(function(){O=m.title=a;if(ba&&j&&j.contentWindow&&j.contentWindow.document){j.contentWindow.document.title=
a;ba=l}},50);return this}return m.title},value:function(a){if(a!==i){a=M(a);if(a=="/")a="";if(f==a&&!L)return;f=a;if(d.autoUpdate||L){C(o);if(G())z[d.history?"pushState":"replaceState"]({},"",d.state.replace(/\/$/,"")+(f===""?"/":f));else{I=o;if(K)if(d.history)n.hash="#"+w(f,o);else n.replace("#"+w(f,o));else if(f!=t())if(d.history)n.hash="#"+w(f,o);else n.replace("#"+w(f,o));A&&!J&&d.history&&r(N,50);if(K)r(function(){I=l},1);else I=l}}return this}return M(f)},path:function(a){if(a!==i){var b=this.queryString(),
e=this.hash();this.value(a+(b?"?"+b:"")+(e?"#"+e:""));return this}return M(f).split("#")[0].split("?")[0]},pathNames:function(){var a=this.path(),b=a.replace(S,"/").split("/");if(a.substr(0,1)=="/"||a.length===0)b.splice(0,1);a.substr(a.length-1,1)=="/"&&b.splice(b.length-1,1);return b},queryString:function(a){if(a!==i){var b=this.hash();this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:""));return this}a=f.split("?");return a.slice(1,a.length).join("?").split("#")[0]},parameter:function(a,b,e){var k,
p;if(b!==i){var P=this.parameterNames();p=[];b=b?b.toString():"";for(k=0;k<P.length;k++){var Q=P[k],v=this.parameter(Q);if(typeof v=="string")v=[v];if(Q==a)v=b===null||b===""?[]:e?v.concat([b]):[b];for(var R=0;R<v.length;R++)p.push(Q+"="+v[R])}c.inArray(a,P)==-1&&b!==null&&b!==""&&p.push(a+"="+b);this.queryString(p.join("&"));return this}if(b=this.queryString()){e=[];p=b.split("&");for(k=0;k<p.length;k++){b=p[k].split("=");b[0]==a&&e.push(b.slice(1).join("="))}if(e.length!==0)return e.length!=1?e:
e[0]}},parameterNames:function(){var a=this.queryString(),b=[];if(a&&a.indexOf("=")!=-1){a=a.split("&");for(var e=0;e<a.length;e++){var k=a[e].split("=")[0];c.inArray(k,b)==-1&&b.push(k)}}return b},hash:function(a){if(a!==i){this.value(f.split("#")[0]+(a?"#"+a:""));return this}a=f.split("#");return a.slice(1,a.length).join("#")}}}();c.fn.address=function(q){var s;if(typeof q=="string"){s=q;q=undefined}c(this).attr("address")||c(s?s:this).live("click",function(g){if(g.shiftKey||g.ctrlKey||g.metaKey||
g.which==2)return true;if(c(this).is("a")){g.preventDefault();g=q?q.call(this):/address:/.test(c(this).attr("rel"))?c(this).attr("rel").split("address:")[1].split(" ")[0]:c.address.state()!==undefined&&!/^\/?$/.test(c.address.state())?c(this).attr("href").replace(new RegExp("^(.*"+c.address.state()+"|\\.)"),""):c(this).attr("href").replace(/^(#\!?|\.)/,"");c.address.value(g)}}).live("submit",function(g){if(c(this).is("form")){g.preventDefault();g=c(this).attr("action");g=q?q.call(this):(g.indexOf("?")!=
-1?g.replace(/&$/,""):g+"?")+c(this).serialize();c.address.value(g)}}).attr("address",true);return this}})(jQuery);
